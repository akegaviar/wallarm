.. _cofigure-backup-ru:

==============================
Настройте схему резервирования
==============================

Установка фильтрующего узла в качестве обратного прокси-сервера
(:term:`reverse-proxy-term-ru`) накладывает серьезные требования к надежности
его работы. Если фильтрующий узел по какой-то причине окажется
неработоспособным (например, из-за выключения питания), то нормальная
работа приложения будет ограничена. Для того чтобы гарантировать высокую
доступность Wallarm, рекомендуется использовать одну из описанных ниже схем
резервирования. При резервировании к основным фильтрующим узлам добавляются
еще и дополнительные -- резервные узлы, на которые в случае аварии будет
автоматически переключен трафик.

Резервирование от датацентра
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Если приложение и фильтрующие узлы установлены в датацентре, то нередко сам
датацентр предлагает услугу «Failover IP».

Использование VRRP или CARP 
~~~~~~~~~~~~~~~~~~~~~~~~~~~

На каждом фильтрующем узле или промежуточном кластере поднимается специальный
демон keepalived или ucarp, который следит за работоспособностью остальных
фильтрующих узлов и быстро переносит IP-адрес на работоспособный узел. Данный
подход является стандартным для обеспечения отказоустойчивости, однако его же
можно использовать для балансировки трафика, подняв по failover-IP на каждом
узле и распределяя между ними трафик при помощи DNS-балансировки.

.. note:: Wallarm предлагает `специальную сборку <https://wallarm.com/nginx-plus-wallarm>`_
          на базе коммерческого NGINX Plus, у которого есть специальная
          обвязка для VRRP. В большинстве дистрибутивов Linux, включая RHEL,
          Debian и другие, есть специальные пакеты, позволяющие запустить этот
          билд самостоятельно. Подробная инструкция по настройке доступна на
          `официальном сайте NGINX <https://www.NGINX.com/resources/admin-guide/nginx-ha-keepalived/>`_.

Аппаратный L3 или L4 балансировщик
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Layer 3 или Layer 4 балансировшик хорошо решает задачи балансировки
и отказоустойчивости. В самом простом варианте реализуется только балансировка.

DNS-балансировка
~~~~~~~~~~~~~~~~

В настройках DNS прописывается несколько IP-адресов. Такая схема в основном
используется для балансировки нагрузки. С определенными оговорками можно
использовать и для обеспечения отказоустойчивости.