.. _use-search-ru:

=================
Используйте поиск
=================

Поиск возможен практически по любым атрибутам атак, инцидентов и уязвимостей.
Wallarm автоматически определяет, к каким атрибутам относятся значения
в поисковой строке. 

В Wallarm реализован язык поиска, приближенный к естественному человеческому
языку, поэтому запрос можно набрать почти интуитивно. Имеется возможность
сделать уточнения с помощью специальных модификаторов-префиксов, о которых
рассказано ниже. 

Если в поисковой строке указаны значения для разных параметров, результат
будет удовлетворять всем условиям. Если указаны несколько значений для
одного параметра, ищется результат, удовлетворяющий любому из них.

Чтобы осуществить поиск в пределах одного веб-приложения, укажите в строке
поиска :command:`pool:<название приложения>`, где <название приложения>
установлено при задании идентификаторов приложения на вкладке
:guilabel:`Приложения` TTK sections/settings.md#applications.

Примеры поисковых запросов:

* :command:`attacks xss` -- поиск всех XSS-атак
* :command:`attacks today` -- поиск любых атак за сегодня
* :command:`vulns sqli`: поиск уязвимостей к атакам типа внедрение SQL-кода TTK term.
* :command:`vulns 01/02/2017-10/03/2017` -- поиск уязвимостей за указанный
  период
* :command:`xss 14/01/2017` -- поиск всех уязвимостей, подозрений, атак
  и инцидентов межсайтового выполнения сценариев на 14 января 2017 года
* :command:`p:xss 14/01/2017` -- поиск всех уязвимостей, подозрений, атак
  и инцидентов всех типов, в параметре НТТР-запроса под именем xss
  (``http://localhost/?xss=attack-here``) за 14 января 2017 года
* :command:`attacks 2-9/2017` -- поиск всех атак с февраля по сентябрь
  2017 года.
* :command:`rce /catalog/import.php`: поиск всех RCE-атак, инцидентов
  и уязвимостей по скрипту ``/catalog/import.php`` за последний день

Помимо строки поиска найти данные помогают также фильтры. См. раздел TTK[Фильтры](filters.md).
Параметры из поисковой строки дублируются в системе фильтров и наоборот.

.. note:: Любой поисковый запрос или комбинацию фильтров можно сохранить
          нажатием кнопки :guilabel:`Сохранить как шаблон`, чтобы в дальнейшем
          вызывать его оперативно. 

Поисковые атрибуты
~~~~~~~~~~~~~~~~~~

* Тип объекта
* Тип атаки или уязвимости
* Цель атаки или уязвимости
* Уровень опасности
* Идентификатор уязвимости
* Статус уязвимости
* Время
* IP-адрес
* Статус ответа сервера
* Размер ответа сервера
* Метод HTTP-запроса
* Домен
* Путь
* Параметр

Ниже рассказано о поиске по каждому типу атрибута.

Поиск по типу объекта
---------------------

Укажите в строке поиска:

* :command:`attack`, :command:`attacks` -- чтобы искать только атаки, которые
  не направлены на известные уязвимости
* :command:`incident`, :command:`incidents` -- чтобы искать только инциденты
  (атаки, эксплуатирующие известную уязвимость)
* :command:`vuln`, :command:`vulns`, :command:`vulnerability`,
  :command:`vulnerabilities` -- чтобы искать только уязвимости

Поиск по типу атаки или уязвимости
----------------------------------

Укажите в строке поиска:

* :command:`csrf` -- чтобы искать Cross Site Request Forgery, атаки/уязвимости межсайтовой подделки запросов. TTK glossary
* :command:`xss` -- чтобы искать Cross Site Scripting, атаки/уязвимости межсайтового выполнения сценариев. TTK glossary
* :command:`sqli` -- чтобы искать SQL injections, атаки/уязвимости внедрения SQL-кода. TTK glossary
* :command:`rce*` -- чтобы искать OS Commanding, атаки/уязвимости выполнения кода на сервере (учитываются Path Traversal, PHP injections, Shell injections). TTK glossary
* :command:`info` -- чтобы искать атаки/уязвимости раскрытия информации.

Название уязвимости может быть указано как большими, так и маленькими буквами.
Т.е. ``SQLI``, ``sqli`` и ``SQLi`` будут восприняты одинаково.

Поиск по цели атаки или уязвимости
----------------------------------

Укажите в строке поиска:

* :command:`client` -- чтобы искать атаки/уязвимости пользовательских данных
* :command:`database` -- чтобы искать атаки/уязвимости базы данных
* :command:`server` -- чтобы искать атаки/уязвимости сервера приложений

Поиск по уровню опасности
-------------------------

Укажите в строке поиска:

* :command:`low` -- низкий уровень опасности
* :command:`medium` -- средний уровень опасности
* :command:`high` -- высокий уровень опасности

Поиск уязвимостей по идентификатору
-----------------------------------

Для поиска уязвимостей по идентификатору можно указывать его в одном из двух вариантов:

* полностью: :command:`WLRM-ABCD-X0123`
* сокращенно: :command:`X0123`

Поиск по статусу уязвимости
---------------------------

Укажите в строке поиска:

* :command:`open` -- актуальная уязвимость
* :command:`closed` -- исправленная уязвимость
* :command:`falsepositive` -- ложное срабатывание

По умолчанию ищутся только актуальные в данный момент уязвимости.

Поиск по времени события
------------------------

Задайте в строке поиска временной интервал. Используемый формат даты
—- ДД/ММ/ГГГГ (например, 14/01/2017). Если год не указан, используется
текущий: так 14.01 -— это тоже самое, что 14.01.2017. По умолчанию ищутся
события за последние сутки. 

В поисковой строке часто удобно использовать строковые алиасы:

* :command:`yesterday` -- всегда равняется вчерашней дате
* :command:`today` -- всегда равняется сегодняшней дате

Для поиска также можно использовать интервалы:

* :command:`10/01-14/01` идентично :command:`10-14/01` идентично
  :command:`10-14/01/2014` идентично :command:`10/01/2014 00:00 — 14/01/2014 23:59`
* по времени (всегда без секунд): :command:`10/01/2014 11:11`,
  :command:`11:30-12:22`, :command:`10/01/2014 11:12 — 14/01/2014 12:14`
* относительно определенного момента, например: :command:`>10/01/14`

Поиск по IP-адресу или диапазону адресов
----------------------------------------

Чтобы искать по IP-адресу или диапазону адресов, укажите в строке префикс
:command:`ip:`. Можно осуществлять поиск по следующим критериям:

* подсети: 192.168/16, 192.168.0.1/24
* маски: 10.0.0., 172., 192.168.
* интервалы: 192.168.0.1-200, 192.168.1-10, 192.168.1-10.*

Также есть возможность искать по общему числу IP-адресов, связанных с
инцидентом (только для атак и инцидентов).

Примеры:

* :command:`xss ip:100+` -- выполнит поиск всех инцидентов и атак XSS TTK Glossaryмежсайтового выполнения сценариев. Если меньше 100 разных IP-адресов было зарегистрировано как атакующие с этим типом атаки, результат поиска будет нулевым.
* :command:`xss p:id ip:100+` -- выполнит поиск всех атак и инцидентов типа
  XSS TTK Glossary для параметра ``id`` (``?id=aaa``) и вернет результат,
  только если число разных IP-адресов превышает 100.

Поиск по статусу ответа сервера
-------------------------------

Для поиска по статусу ответа сервера укажите префикс :command:`statuscode:`.

Статус для поиска может быть задан в виде:

* числа от 100 до 999
* диапазона N — M, где N и M это числа от 100 до 999
* диапазона N+ и N-, где N это число от 100 до 999

Поиск по размеру ответа сервера
-------------------------------

Для поиска по размеру ответа сервера укажите в строке поиска префикс
:command:`s:` или :command:`size:`.

В качестве параметра поиска можно указать любое целое число. Числа больше
999 могут задаваться без префикса. Можно указывать диапазоны N — M, N+ и N-.
Если в диапазоне числа больше 999, то префикс также можно не указывать.

Поиск по методу HTTP-запроса
----------------------------

Для поиска по методу HTTP-запроса укажите префикс :command:`method:`.

:command:`GET`, :command:`POST`, :command:`PUT`, :command:`DELETE`
и :command:`OPTIONS` в качестве параметра поиска с учетом регистра могут быть
указаны без префикса. Для указания всех остальных значений необходимо
использовать префикс.

Поиск по домену
---------------

Для поиска по домену укажите префиксы :command:`d:` или :command:`domain:`.

Без префикса обрабатывается любая строка, которая может быть доменом второго
и более уровня. С префиксом может быть указана любая строка.

В домене можно использовать маски. Символ :command:`\` заменяет любое
количество символов, символ :command:`?` заменяет любой один символ.

Поиск по пути
-------------

Для поиска по пути укажите префикс :command:`u:` или :command:`url:`.

Без префикса обрабатываются строки, которые начинаются с :command:`/.
С префиксом может быть указана любая строка.

Поиск по параметру
------------------

Для поиска по параметру укажите префикс :command:`p:`, :command:`param:`
или :command:`parameter:`, а также суффикс :command:`=`.

Например, если необходимо найти атаки на параметр :command:`xss`, а не
xss-атаки (например, найти атаку типа SQL-injection в GET-параметре ``xss``),
то в поисковой строке следует ввести :command:`attacks p:xss`.

Строка, которая начинается не с :command:`/` и заканчивается на :command:`=`
расссматривается как параметр (при этом завершающий :command:`=` в значение
не входит). С префиксом может быть указана любая строка.

Поиск аномалий в атаках
-----------------------

Для поиска аномалий в атаках укажите префикс :command:`a:` или
:command:`anomaly:`.

Поддерживаемые параметры для поиска аномалий:

* :command:`size*`
* :command:`statuscode`
* :command:`time`
* :command:`stamps`
* :command:`impression`
* :command:`vector`

Пример:

Поиск :command:`attacks sqli a:size` найдет все атаки вида SQL-инъекция TTK glossary, где в запросах были аномалии размера ответа.

.. seealso::

   - :ref:`use-filter-ru`